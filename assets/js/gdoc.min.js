/*!
 * gDoc.js v2.0.1 (https://github.com/jadeallencook/gDoc)
 * Copyright 2016-2016 Jade Allen Cook
 * Licensed under the MIT license
 * Built using Tabletop.js
 */

// tabletop.js minified
!function(){"use strict";var e=!1;if("undefined"!=typeof process&&!process.browser){e=!0;var t=require("request".trim())}var n=!1,s=!1;try{var o=new XMLHttpRequest;"undefined"!=typeof o.withCredentials?n=!0:"XDomainRequest"in window&&(n=!0,s=!0)}catch(i){}var l=Array.prototype.indexOf,r=function(e,t){var n=0,s=e.length;if(l&&e.indexOf===l)return e.indexOf(t);for(;s>n;n++)if(e[n]===t)return n;return-1},a=function(t){return this&&this instanceof a?("string"==typeof t&&(t={key:t}),this.callback=t.callback,this.wanted=t.wanted||[],this.key=t.key,this.simpleSheet=!!t.simpleSheet,this.parseNumbers=!!t.parseNumbers,this.wait=!!t.wait,this.reverse=!!t.reverse,this.postProcess=t.postProcess,this.debug=!!t.debug,this.query=t.query||"",this.orderby=t.orderby,this.endpoint=t.endpoint||"https://spreadsheets.google.com",this.singleton=!!t.singleton,this.simple_url=!!t.simple_url,this.callbackContext=t.callbackContext,this.prettyColumnNames="undefined"==typeof t.prettyColumnNames?!t.proxy:t.prettyColumnNames,"undefined"!=typeof t.proxy&&(this.endpoint=t.proxy.replace(/\/$/,""),this.simple_url=!0,this.singleton=!0,n=!1),this.parameterize=t.parameterize||!1,this.singleton&&("undefined"!=typeof a.singleton&&this.log("WARNING! Tabletop singleton already defined"),a.singleton=this),/key=/.test(this.key)&&(this.log("You passed an old Google Docs url as the key! Attempting to parse."),this.key=this.key.match("key=(.*?)(&|#|$)")[1]),/pubhtml/.test(this.key)&&(this.log("You passed a new Google Spreadsheets url as the key! Attempting to parse."),this.key=this.key.match("d\\/(.*?)\\/pubhtml")[1]),this.key?(this.log("Initializing with key "+this.key),this.models={},this.model_names=[],this.base_json_path="/feeds/worksheets/"+this.key+"/public/basic?alt=",this.base_json_path+=e||n?"json":"json-in-script",void(this.wait||this.fetch())):void this.log("You need to pass Tabletop a key!")):new a(t)};a.callbacks={},a.init=function(e){return new a(e)},a.sheets=function(){this.log("Times have changed! You'll want to use var tabletop = Tabletop.init(...); tabletop.sheets(...); instead of Tabletop.sheets(...)")},a.prototype={fetch:function(e){"undefined"!=typeof e&&(this.callback=e),this.requestData(this.base_json_path,this.loadSheets)},requestData:function(t,o){if(e)this.serverSideFetch(t,o);else{var i=this.endpoint.split("//").shift()||"http";!n||s&&i!==location.protocol?this.injectScript(t,o):this.xhrFetch(t,o)}},xhrFetch:function(e,t){var n=s?new XDomainRequest:new XMLHttpRequest;n.open("GET",this.endpoint+e);var o=this;n.onload=function(){try{var e=JSON.parse(n.responseText)}catch(s){console.error(s)}t.call(o,e)},n.send()},injectScript:function(e,t){var n,s=document.createElement("script");if(this.singleton)t===this.loadSheets?n="Tabletop.singleton.loadSheets":t===this.loadSheet&&(n="Tabletop.singleton.loadSheet");else{var o=this;n="tt"+ +new Date+Math.floor(1e5*Math.random()),a.callbacks[n]=function(){var e=Array.prototype.slice.call(arguments,0);t.apply(o,e),s.parentNode.removeChild(s),delete a.callbacks[n]},n="Tabletop.callbacks."+n}var i=e+"&callback="+n;s.src=this.simple_url?-1!==e.indexOf("/list/")?this.endpoint+"/"+this.key+"-"+e.split("/")[4]:this.endpoint+"/"+this.key:this.endpoint+i,this.parameterize&&(s.src=this.parameterize+encodeURIComponent(s.src)),document.getElementsByTagName("script")[0].parentNode.appendChild(s)},serverSideFetch:function(e,n){var s=this;t({url:this.endpoint+e,json:!0},function(e,t,o){return e?console.error(e):void n.call(s,o)})},isWanted:function(e){return 0===this.wanted.length?!0:-1!==r(this.wanted,e)},data:function(){return 0===this.model_names.length?void 0:this.simpleSheet?(this.model_names.length>1&&this.debug&&this.log("WARNING You have more than one sheet but are using simple sheet mode! Don't blame me when something goes wrong."),this.models[this.model_names[0]].all()):this.models},addWanted:function(e){-1===r(this.wanted,e)&&this.wanted.push(e)},loadSheets:function(t){var s,o,i=[];for(this.googleSheetName=t.feed.title.$t,this.foundSheetNames=[],s=0,o=t.feed.entry.length;o>s;s++)if(this.foundSheetNames.push(t.feed.entry[s].title.$t),this.isWanted(t.feed.entry[s].content.$t)){var l=t.feed.entry[s].link.length-1,r=t.feed.entry[s].link[l].href.split("/").pop(),a="/feeds/list/"+this.key+"/"+r+"/public/values?alt=";a+=e||n?"json":"json-in-script",this.query&&(a+="&sq="+this.query),this.orderby&&(a+="&orderby=column:"+this.orderby.toLowerCase()),this.reverse&&(a+="&reverse=true"),i.push(a)}for(this.sheetsToLoad=i.length,s=0,o=i.length;o>s;s++)this.requestData(i[s],this.loadSheet)},sheets:function(e){return"undefined"==typeof e?this.models:"undefined"==typeof this.models[e]?void 0:this.models[e]},sheetReady:function(e){this.models[e.name]=e,-1===r(this.model_names,e.name)&&this.model_names.push(e.name),this.sheetsToLoad--,0===this.sheetsToLoad&&this.doCallback()},loadSheet:function(e){{var t=this;new a.Model({data:e,parseNumbers:this.parseNumbers,postProcess:this.postProcess,tabletop:this,prettyColumnNames:this.prettyColumnNames,onReady:function(){t.sheetReady(this)}})}},doCallback:function(){0===this.sheetsToLoad&&this.callback.apply(this.callbackContext||this,[this.data(),this])},log:function(){this.debug&&"undefined"!=typeof console&&"undefined"!=typeof console.log&&Function.prototype.apply.apply(console.log,[console,arguments])}},a.Model=function(e){var t,n,s,o;if(this.column_names=[],this.name=e.data.feed.title.$t,this.tabletop=e.tabletop,this.elements=[],this.onReady=e.onReady,this.raw=e.data,"undefined"==typeof e.data.feed.entry)return e.tabletop.log("Missing data for "+this.name+", make sure you didn't forget column headers"),this.original_columns=[],this.elements=[],void this.onReady.call(this);for(var i in e.data.feed.entry[0])/^gsx/.test(i)&&this.column_names.push(i.replace("gsx$",""));for(this.original_columns=this.column_names,t=0,s=e.data.feed.entry.length;s>t;t++){for(var l=e.data.feed.entry[t],r={},n=0,o=this.column_names.length;o>n;n++){var a=l["gsx$"+this.column_names[n]];r[this.column_names[n]]="undefined"!=typeof a?e.parseNumbers&&""!==a.$t&&!isNaN(a.$t)?+a.$t:a.$t:""}void 0===r.rowNumber&&(r.rowNumber=t+1),e.postProcess&&e.postProcess(r),this.elements.push(r)}e.prettyColumnNames?this.fetchPrettyColumns():this.onReady.call(this)},a.Model.prototype={all:function(){return this.elements},fetchPrettyColumns:function(){if(!this.raw.feed.link[3])return this.ready();var e=this.raw.feed.link[3].href.replace("/feeds/list/","/feeds/cells/").replace("https://spreadsheets.google.com",""),t=this;this.tabletop.requestData(e,function(e){t.loadPrettyColumns(e)})},ready:function(){this.onReady.call(this)},loadPrettyColumns:function(e){for(var t={},n=this.column_names,s=0,o=n.length;o>s;s++)t[n[s]]="undefined"!=typeof e.feed.entry[s].content.$t?e.feed.entry[s].content.$t:n[s];this.pretty_columns=t,this.prettifyElements(),this.ready()},prettifyElements:function(){var e,t,n,s,o,i=[],o=[];for(t=0,s=this.column_names.length;s>t;t++)o.push(this.pretty_columns[this.column_names[t]]);for(e=0,n=this.elements.length;n>e;e++){var l={};for(t=0,s=this.column_names.length;s>t;t++){var r=this.pretty_columns[this.column_names[t]];l[r]=this.elements[e][this.column_names[t]]}i.push(l)}this.elements=i,this.column_names=o},toArray:function(){var e,t,n,s,o=[];for(e=0,n=this.elements.length;n>e;e++){var i=[];for(t=0,s=this.column_names.length;s>t;t++)i.push(this.elements[e][this.column_names[t]]);o.push(i)}return o}},"undefined"!=typeof module&&module.exports?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):window.Tabletop=a}();

// gDoc.js minified
window.gDoc=function(e,t){var s={layout:function(){function s(e){Tabletop.init({key:e,callback:n,simpleSheet:!1})}function n(e){e=e[t].elements[0];for(var s=Object.keys(e),n=Object.keys(e).map(function(t){return e[t]}),o=0;o<s.length;o++)if(s[o].indexOf(":")>-1){var r=s[o].substr(s[o].indexOf(":")+1),a=s[o].substr(0,s[o].indexOf(":"));a=document.querySelector('[gDoc="'+a+'"]'),a.setAttribute(r,n[o])}else{var a=document.querySelector('[gDoc="'+s[o]+'"]');a.innerHTML=n[o]}}s(e)},block:function(){function t(e){Tabletop.init({key:e,callback:n,simpleSheet:!1})}function n(e){if(e=e[r].elements,0==i)for(var t=0;t<e.length;t++)s.html(e,t,a,l,c);else for(var t=0;i>t;t++)s.html(e,t,a,l,c)}var o=e["public"],r=e.sheet,a=e.gDoc,c=e.columns,i=e.loop,l=e.html();t(o)},html:function(e,t,s,n,o){e=e[t];for(var r=0;r<o.length;r++){var a=o[r],c=e[a];n=n.replace("{{"+a+"}}",c)}s=document.querySelector('[gDoc="'+s+'"]'),s.insertAdjacentHTML("beforeend",n)},connect:function(){var t="https://docs.google.com/forms/d/e/"+e.id+"/viewform",s=$("#"+e.appendTo);jQuery.ajax=function(e){function t(e){return!o.test(e)&&/:\/\//.test(e)}var s=location.protocol,n=location.hostname,o=RegExp(s+"//"+n),r="http"+(/^https/.test(s)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?",a='select * from html where url="{URL}" and xpath="*"';return function(s){var n=s.url;return/get/i.test(s.type)&&!/json/i.test(s.dataType)&&t(n)&&(s.url=r,s.dataType="json",s.data={q:a.replace("{URL}",n+(s.data?(/\?/.test(n)?"&":"?")+jQuery.param(s.data):"")),format:"xml"},!s.success&&s.complete&&(s.success=s.complete,delete s.complete),s.success=function(e){return function(t){e&&e.call(this,{responseText:t.results[0].replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi,"")},"success")}}(s.success)),e.apply(this,arguments)}}(jQuery.ajax),s.empty(),void 0!==e.preloader?s.append('<img class="gDoc-preloader-'+e.id+'" width="50px" src="'+e.preloader+'" />'):s.append('<span class="gDoc-preloader-'+e.id+'">Loading Form...<span>'),$.ajax({url:t,type:"GET",success:function(t){var n=new String,o=new Object,r=($(t.responseText).find("form").attr("action"),$(t.responseText).find('input[type="text"]'));$(".gDoc-proloader-"+e.id);if("string"==typeof e.successMsg)var a=e.successMsg;else var a="Success";if("string"==typeof e.submitValue)var c=e.submitValue;else var c="Submit";r.each(function(){n+='<input type="text" ',n+='name="'+$(this).attr("name")+'" ',n+='placeholder="'+$(this).attr("aria-label")+'" ',"required"===$(this).attr("required")&&(n+="required"),n+="/>",o[$(this).attr("name")]=new String}),n+='<input type="submit" value="'+c+'" />',s.empty().append(n),s.submit(function(t){t.preventDefault(),r=s.find('input[type="text"]');for(var n=0,c=r.length-1;c>=n;n++){var i=$(r[n]);o[i.attr("name")]=i.val()}$.ajax({url:"https://docs.google.com/forms/d/e/"+e.id+"/formResponse",data:o,type:"POST",dataType:"json",error:function(){console.log("XMLHttpRequest error will appear, this is nothing to worry about."),s.empty().append('<span class="gdoc-success">'+a+"</span>")},success:function(){s.empty().append('<span class="gdoc-success">'+a+"</span>")}})})}})}};"object"==typeof e?e.connect===!0?s.connect():s.block():s.layout()};
